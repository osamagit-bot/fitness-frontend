import{j as e}from"./ui-D95r1dMF.js";import{r as t}from"./vendor-iz3JPVmO.js";import{m as s,d as a,j as r,A as l,a as i,s as d}from"./index-CoDTQVyW.js";import{u as n}from"./router-D8KzWLZn.js";import"./utils-CCtIn9I6.js";function x(){const[x,m]=t.useState([]),[c,o]=t.useState([]),[p,h]=t.useState(!1),[y,u]=t.useState(""),g=n();t.useState(!1);const[f,b]=t.useState({startDate:"",endDate:"",filterType:"all"}),[j,N]=t.useState("all"),[w,v]=t.useState(""),_=async()=>{var e,t;h(!0),u("");try{const e=localStorage.getItem("admin_access_token"),t=await i.get("members/",{headers:{Authorization:`Bearer ${e}`}}),s=t.data.results||t.data;m(Array.isArray(s)?s:[]),o(Array.isArray(s)?s:[])}catch(s){u((null==(t=null==(e=s.response)?void 0:e.data)?void 0:t.message)||"Failed to fetch athletes")}finally{h(!1)}};t.useEffect((()=>{_(),"true"===localStorage.getItem("membershipRenewed")&&(localStorage.removeItem("membershipRenewed"),setTimeout(_,500))}),[]),t.useEffect((()=>{S()}),[x,f,j,w]);const S=()=>{let e=[...x];if(w.trim()){const t=w.toLowerCase().trim();e=e.filter((e=>{var s,a,r,l;const i=`${e.first_name} ${e.last_name}`.toLowerCase(),d=(null==(s=e.athlete_id)?void 0:s.toString().toLowerCase())||"",n=(null==(a=e.membership_type)?void 0:a.toLowerCase())||"",x=(null==(r=e.box_number)?void 0:r.toString().toLowerCase())||"",m=(null==(l=e.time_slot)?void 0:l.toLowerCase())||"";return i.includes(t)||d.includes(t)||n.includes(t)||x.includes(t)||m.includes(t)}))}if("today"===f.filterType){const t=(new Date).toISOString().split("T")[0];e=e.filter((e=>e.start_date&&e.start_date.startsWith(t)))}else if("thisMonth"===f.filterType){const t=(new Date).getMonth()+1,s=(new Date).getFullYear();e=e.filter((e=>{if(!e.start_date)return!1;const[a,r]=e.start_date.split("-");return parseInt(r)===t&&parseInt(a)===s}))}else"custom"===f.filterType&&f.startDate&&f.endDate&&(e=e.filter((e=>!!e.start_date&&(e.start_date>=f.startDate&&e.start_date<=f.endDate))));"expired"===j?e=e.filter((e=>F(e.expiry_date))):"expiringSoon"===j?e=e.filter((e=>T(e.expiry_date))):"active"===j&&(e=e.filter((e=>!F(e.expiry_date)&&!T(e.expiry_date)))),o(e)},k=()=>{b({startDate:"",endDate:"",filterType:"all"}),N("all"),v(""),o(x)},D=e=>{N(e)},C=async e=>{if(window.confirm("Are you sure you want to delete this athlete?"))try{const t=localStorage.getItem("admin_access_token");await i.delete(`members/${e}/`,{headers:{Authorization:`Bearer ${t}`}}),_(),d.success("Athlete deleted successfully!")}catch(t){d.error("Failed to delete athlete. Please try again.")}},A=e=>{const t=new URLSearchParams({renewMode:"true",athleteId:e.athlete_id,firstName:e.first_name,lastName:e.last_name,membershipType:e.membership_type,monthlyFee:e.monthly_fee,boxNumber:e.box_number||"",timeSlot:e.time_slot||"morning"});g(`/admin/register?${t.toString()}`)},$=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},E=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"Not specified",F=e=>{if(!e)return!1;const t=new Date;t.setHours(0,0,0,0);const s=new Date(e);return s.setHours(0,0,0,0),s<t},T=e=>{if(!e)return!1;const t=new Date;t.setHours(0,0,0,0);const s=new Date(e);if(s.setHours(0,0,0,0),s<t)return!1;return Math.ceil((s-t)/864e5)<=7},M=e=>{if(!e)return 0;const t=new Date;t.setHours(0,0,0,0);const s=new Date(e);return s.setHours(0,0,0,0),Math.ceil((s-t)/864e5)};return e.jsxs(e.Fragment,{children:[e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"p-2 md:p-0 min-h-screen bg-gray-900",children:[e.jsx(s.h1,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1,duration:.5},className:"text-xl md:text-2xl lg:ml-6 font-bold mb-4 md:mb-6 text-yellow-400",children:"Athletes/Members Management"}),y&&e.jsxs("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-md",children:[e.jsx("p",{className:"font-semibold",children:"Error"}),e.jsx("p",{children:y}),e.jsx("button",{onClick:_,className:"mt-2 px-3 py-1 bg-red-200 rounded hover:bg-red-300",children:"Try Again"})]}),e.jsxs(s.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.2,duration:.5},className:"bg-gray-800 p-3 md:p-6 rounded-lg shadow-md border border-gray-700",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(a,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by name, ID, membership type, box number, or time slot...",value:w,onChange:e=>v(e.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-600 rounded-md leading-5 bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:placeholder-gray-300 focus:ring-1 focus:ring-yellow-500 focus:border-yellow-500 text-sm"}),w&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:()=>v(""),className:"text-gray-400 hover:text-gray-600",children:e.jsx(r,{className:"h-5 w-5"})})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-white",children:"Members List"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>D("expired"),children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs md:text-sm text-gray-300",children:"Expired"})]}),e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>D("expiringSoon"),children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs md:text-sm text-gray-300",children:"Expiring Soon"})]}),e.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>D("active"),children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs md:text-sm text-gray-300",children:"Active"})]}),e.jsx("button",{onClick:()=>{k(),N("all")},className:"px-3 py-1 md:px-4 md:py-2 bg-yellow-400 text-black rounded hover:bg-yellow-600",children:"Refresh"})]})]}),("all"!==f.filterType||"all"!==j||w.trim())&&e.jsxs("div",{className:"mb-4 p-2 bg-gray-700 rounded-md text-sm flex items-center justify-between",children:[e.jsxs("div",{className:"text-gray-300",children:["Showing ","all"!==j&&`${j} `,w.trim()&&`search results for "${w}" `,"(",c.length," of ",x.length," members)"]}),e.jsxs("button",{onClick:k,className:"text-yellow-400 hover:text-yellow-300 text-sm flex items-center",children:[e.jsx(r,{className:"mr-1"})," Clear all filters"]})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-600",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Box"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Fee"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Registered On"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Expiry Date"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-3 md:px-6 py-2 md:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-gray-600 divide-y text-white divide-gray-400",children:0===c.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",className:"px-3 md:px-6 py-4 text-center text-gray-500",children:w.trim()?`No members found matching "${w}"`:"all"!==j?`No ${j} members found`:"No athletes found"})}):c.map((t=>{const s=F(t.expiry_date),a=T(t.expiry_date),r=M(t.expiry_date);return e.jsxs("tr",{className:`\n                ${s?"bg-red-50 hover:bg-red-100 text-sm":""}\n                ${a&&!s?"bg-yellow-50 text-sm hover:bg-yellow-100":""}\n                ${s||a?"":"hover:bg-gray-500 text-sm"}\n              `,children:[e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:t.athlete_id}),e.jsxs("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap "+(s?"text-red-700 font-semibold":""),children:[t.first_name," ",t.last_name]}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap capitalize",children:t.membership_type}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:t.box_number||"-"}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap capitalize",children:E(t.time_slot)}),e.jsxs("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:[parseFloat(t.monthly_fee).toFixed(2)," AFN"]}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:$(t.start_date)}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap "+(s?"text-red-600 font-semibold":""),children:$(t.expiry_date)}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:s?e.jsxs("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-700",children:["Expired ",Math.abs(r)," days ago"]}):a?e.jsxs("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-700",children:["Expires in ",r," days"]}):e.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700",children:"Active"})}),e.jsx("td",{className:"px-3 md:px-6 py-2 md:py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[s&&e.jsx("button",{onClick:()=>A(t),className:"text-white p-2 rounded-md bg-amber-600 hover:text-blue-300 mr-2",children:"Renew"}),e.jsx("button",{onClick:()=>C(t.athlete_id),className:"text-black p-2 rounded-md bg-red-400 hover:text-red-900",children:"Delete"})]})})]},t.athlete_id)}))})]})}),e.jsx("div",{className:"md:hidden",children:0===c.length?e.jsx("div",{className:"text-center py-4 text-gray-500",children:w.trim()?`No members found matching "${w}"`:"all"!==j?`No ${j} members found`:"No athletes found"}):e.jsx("div",{className:"space-y-4",children:c.map((t=>{const s=F(t.expiry_date),a=T(t.expiry_date),r=M(t.expiry_date);return e.jsxs("div",{className:`\n              border rounded-lg p-4 shadow-sm\n              ${s?"bg-red-50 border-red-200":""}\n              ${a&&!s?"bg-yellow-50 border-yellow-200":""}\n              ${s||a?"":"bg-white border-gray-200"}\n            `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-lg "+(s?"text-red-700":"text-gray-800"),children:[t.first_name," ",t.last_name]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["ID: ",t.athlete_id]})]}),e.jsx("div",{children:s?e.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-700",children:"Expired"}):a?e.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-700",children:"Expiring Soon"}):e.jsx("span",{className:"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700",children:"Active"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Membership:"}),e.jsx("p",{className:"capitalize",children:t.membership_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Monthly Fee:"}),e.jsxs("p",{children:[parseFloat(t.monthly_fee).toFixed(2)," AFN"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Box:"}),e.jsx("p",{children:t.box_number||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Time Slot:"}),e.jsx("p",{className:"capitalize",children:E(t.time_slot)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Registered:"}),e.jsx("p",{children:$(t.start_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Expires:"}),e.jsx("p",{className:s?"text-red-600 font-semibold":"",children:$(t.expiry_date)})]})]}),s?e.jsxs("p",{className:"text-red-700 text-sm mb-3",children:["Expired ",Math.abs(r)," days ago"]}):a?e.jsxs("p",{className:"text-yellow-700 text-sm mb-3",children:["Expires in ",r," days"]}):e.jsxs("p",{className:"text-green-700 text-sm mb-3",children:["Valid for ",r," days"]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-2 border-t",children:[s&&e.jsx("button",{onClick:()=>A(t),className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-md text-sm",children:"Renew"}),e.jsx("button",{onClick:()=>C(t.athlete_id),className:"px-3 py-1 bg-red-100 text-red-700 rounded-md text-sm",children:"Delete"})]})]},t.athlete_id)}))})})]})]}),e.jsx(l,{})]})}export{x as default};
