import{j as e}from"./ui-D95r1dMF.js";import{r as s}from"./vendor-iz3JPVmO.js";import{a as t,o as a,p as r,q as l,r as o,f as i,b as n,t as d,u as c,v as x,A as m,s as h}from"./index-CoDTQVyW.js";import"./utils-CCtIn9I6.js";import"./router-D8KzWLZn.js";function u(){var u;const[p,g]=s.useState([]),[y,b]=s.useState([]),[f,j]=s.useState("tickets"),[w,v]=s.useState(null),[N,k]=s.useState(!0),[C,q]=s.useState(null),[A,F]=s.useState(""),[S,Q]=s.useState(""),[L,P]=s.useState({category:"",question:"",answer:""}),[_,T]=s.useState("all"),[$,z]=s.useState({}),[B,D]=s.useState(""),[M,R]=s.useState(!1),O=localStorage.getItem("access_token");s.useEffect((()=>{E()}),[]);const E=async()=>{k(!0);try{const e={headers:{Authorization:`Bearer ${O}`}},s=await t.get("admin-support/tickets/",e);g(Array.isArray(s.data)?s.data:[]);const a=await t.get("admin-support/faq-categories/",e),r=Array.isArray(a.data)?a.data:[];b(r);const l={};r.forEach((e=>{l[e.id]=!1})),z(l),k(!1)}catch(e){q("Failed to load support management data. Please try again later."),k(!1)}},W=Array.isArray(p)?p.filter((e=>"all"===_||e.status===_)):[],I=Array.isArray(y)?y.filter((e=>e.name.toLowerCase().includes(B.toLowerCase())||e.faqs&&e.faqs.some((e=>e.question.toLowerCase().includes(B.toLowerCase())||e.answer.toLowerCase().includes(B.toLowerCase()))))):[];return N?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):C?e.jsxs("div",{className:"text-center p-10",children:[e.jsx("div",{className:"text-red-500 mb-4",children:C}),e.jsx("button",{onClick:E,className:"px-4 py-2 bg-amber-600 text-white rounded hover:bg-blue-600 transition-colors",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mx-auto p-4 max-w-7xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Support Management"}),e.jsx("p",{className:"text-gray-300",children:"Manage support tickets and FAQs for your platform"})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsxs("button",{onClick:()=>j("tickets"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+("tickets"===f?"border-yellow-500 text-yellow-500":"border-transparent text-gray-300 hover:text-white hover:border-gray-500"),children:[e.jsx(a,{className:"h-5 w-5"}),e.jsx("span",{children:"Support Tickets"})]}),e.jsxs("button",{onClick:()=>j("faqs"),className:"py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2 "+("faqs"===f?"border-yellow-500 text-yellow-500":"border-transparent text-gray-300 hover:text-white hover:border-gray-500"),children:[e.jsx(r,{className:"h-5 w-5"}),e.jsx("span",{children:"FAQ Management"})]})]})}),"tickets"===f&&e.jsxs("div",{className:"bg-gray-700 rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-600",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Support Tickets"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3",children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{className:"appearance-none pl-4 pr-10 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white",value:_,onChange:e=>T(e.target.value),children:[e.jsx("option",{value:"all",children:"All Tickets"}),e.jsx("option",{value:"open",children:"Open Tickets"}),e.jsx("option",{value:"closed",children:"Closed Tickets"}),e.jsx("option",{value:"responded",children:"Responded Tickets"})]}),e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-300",children:e.jsx("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]})})]})}),W.length>0?e.jsx("div",{className:"divide-y divide-gray-600",children:W.map((s=>e.jsxs("div",{className:"transition-all duration-200 "+(w===s.id?"bg-gray-600":"hover:bg-gray-600"),children:[e.jsx("div",{className:"p-6 cursor-pointer "+("open"===s.status?"border-l-4 border-blue-500":"responded"===s.status?"border-l-4 border-yellow-500":"border-l-4 border-green-500"),onClick:()=>v(w===s.id?null:s.id),children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center "+("open"===s.status?"bg-blue-100 text-blue-600":"responded"===s.status?"bg-yellow-100 text-yellow-600":"bg-green-100 text-green-600"),children:"open"===s.status?e.jsx(a,{className:"h-5 w-5"}):"responded"===s.status?e.jsx(l,{className:"h-5 w-5"}):e.jsx(o,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.subject}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-sm text-gray-300 mt-1",children:[e.jsxs("p",{children:["From: ",s.member_name]}),e.jsxs("p",{children:["Type: ",s.type]}),e.jsxs("p",{children:["Date: ",s.date_created?i(s.date_created):s.created_at?i(s.created_at):s.timestamp?i(s.timestamp):(new Date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full "+("open"===s.status?"bg-blue-100 text-blue-800":"responded"===s.status?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:"open"===s.status?"Open":"responded"===s.status?"Responded":"Closed"}),"closed"!==s.status&&e.jsx("button",{onClick:e=>{e.stopPropagation(),(async e=>{try{await t.patch(`admin-support/${e}/close/`,{},{headers:{Authorization:`Bearer ${O}`}}),g(p.map((s=>s.id===e?{...s,status:"closed"}:s)))}catch(s){h.error("Failed to close ticket. Please try again.")}})(s.id)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Close ticket",children:e.jsx(o,{className:"h-5 w-5"})})]})]})}),w===s.id&&e.jsxs("div",{className:"px-6 pb-6 pt-2 bg-gray-700",children:[e.jsxs("div",{className:"mt-4 p-4 bg-gray-600 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-white mb-2",children:"Original Message:"}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s.message})]}),s.responses&&s.responses.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-white mb-3",children:"Responses:"}),e.jsx("div",{className:"space-y-3",children:s.responses.map(((s,t)=>e.jsxs("div",{className:"bg-yellow-500/10 p-4 rounded-lg border border-yellow-500/30 shadow-xs",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("p",{className:"font-medium text-sm text-white",children:s.author}),e.jsx("p",{className:"text-xs text-gray-400",children:s.date_created?n(s.date_created):s.created_at?n(s.created_at):(new Date).toLocaleDateString()})]}),e.jsx("p",{className:"text-gray-300 whitespace-pre-line",children:s.message})]},t)))})]}),"closed"!==s.status&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-medium text-white mb-3",children:"Add Response:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{placeholder:"Type your response here...",className:"w-full px-4 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white placeholder-gray-400",rows:"4",value:A,onChange:e=>F(e.target.value)}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{F(""),v(null)},className:"px-4 py-2 border border-gray-600 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>(async e=>{if(A.trim())try{const s=await t.post(`admin-support/${e}/respond/`,{message:A},{headers:{Authorization:`Bearer ${O}`}});g(p.map((t=>t.id===e?{...t,responses:[...t.responses||[],s.data],status:"responded"}:t))),F("")}catch(s){h.error("Failed to send response. Please try again.")}else h.warn("Please enter a response message")})(s.id),className:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-black rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition-all duration-300",children:"Send Response"})]})]})]})]})]},s.id)))}):e.jsxs("div",{className:"p-10 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-4",children:e.jsx(a,{className:"h-12 w-12 mx-auto"})}),e.jsx("p",{className:"text-gray-500",children:"No tickets found matching the selected filter."})]})]}),"faqs"===f&&e.jsxs("div",{className:"bg-gray-700 rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-600",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"FAQ Management"}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx("input",{type:"text",placeholder:"Search FAQs...",className:"w-full pl-4 pr-10 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white placeholder-gray-400",value:B,onChange:e=>D(e.target.value)}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-6",children:[e.jsx("div",{className:"lg:col-span-1 border-b lg:border-b-0 lg:border-r border-gray-600",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-white",children:"Categories"}),e.jsx("button",{onClick:()=>R(!M),className:"p-1 text-gray-400 hover:text-blue-500 transition-colors",title:M?"Cancel":"Add category",children:e.jsx(d,{className:"h-5 w-5"})})]}),M&&e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),S.trim())try{const e=await t.post("admin-support/faq-categories/",{name:S},{headers:{Authorization:`Bearer ${O}`}});b([...y,e.data]),Q(""),R(!1),z((s=>({...s,[e.data.id]:!0})))}catch(s){h.error("Failed to create FAQ category. Please try again.")}},className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"New category name",className:"flex-1 px-3 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 bg-gray-800 text-white placeholder-gray-400",value:S,onChange:e=>Q(e.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"px-3 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-black rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition-all duration-300",children:"Add"})]})}),e.jsx("div",{className:"space-y-2",children:I.length>0?I.map((s=>{var a;return e.jsxs("div",{className:"border border-gray-600 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-600",onClick:()=>{return e=s.id,void z((s=>({...s,[e]:!s[e]})));var e},children:[e.jsx("span",{className:"font-medium text-white",children:s.name}),e.jsxs("span",{className:"flex items-center",children:[e.jsx("span",{className:"text-xs bg-gray-600 text-gray-300 px-2 py-1 rounded-full mr-2",children:(null==(a=s.faqs)?void 0:a.length)||0}),$[s.id]?e.jsx(c,{className:"h-4 w-4 text-gray-300"}):e.jsx(x,{className:"h-4 w-4 text-gray-300"})]})]}),$[s.id]&&s.faqs&&s.faqs.length>0&&e.jsx("div",{className:"border-t border-gray-600 divide-y divide-gray-600",children:s.faqs.map((a=>e.jsx("div",{className:"p-3 bg-gray-600",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:a.question}),e.jsx("p",{className:"text-sm text-gray-300 line-clamp-2",children:a.answer})]}),e.jsx("button",{onClick:()=>(async(e,s)=>{if(window.confirm("Are you sure you want to delete this FAQ?"))try{await t.delete(`admin-support/${e}/delete-faq/`,{headers:{Authorization:`Bearer ${O}`}}),b(y.map((t=>t.id===s?{...t,faqs:t.faqs.filter((s=>s.id!==e))}:t)))}catch(a){h.error("Failed to delete FAQ. Please try again.")}})(a.id,s.id),className:"text-red-400 hover:text-red-600 transition-colors",title:"Delete FAQ",children:e.jsx(o,{className:"h-4 w-4"})})]})},a.id)))})]},s.id)})):e.jsx("div",{className:"text-center py-4 text-gray-300",children:"No categories found matching your search."})})]})}),e.jsxs("div",{className:"lg:col-span-2 p-6",children:[e.jsx("h3",{className:"font-semibold text-white mb-4",children:"Create New FAQ"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),L.category&&L.question.trim()&&L.answer.trim())try{const e=await t.post("admin-support/faqs/",L,{headers:{Authorization:`Bearer ${O}`,"Content-Type":"application/json"}});b(y.map((s=>s.id===L.category?{...s,faqs:[...s.faqs||[],e.data],expanded:!0}:s))),P({category:L.category,question:"",answer:""})}catch(s){h.error("Failed to create FAQ. Please try again.")}else h.warn("Please fill in all FAQ fields")},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category-select",className:"block text-sm font-medium text-white mb-1",children:"Category"}),e.jsxs("select",{id:"category-select",className:"w-full px-4 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white",value:L.category,onChange:e=>P({...L,category:e.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),y.map((s=>e.jsx("option",{value:s.id,children:s.name},s.id)))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"question",className:"block text-sm font-medium text-white mb-1",children:"Question"}),e.jsx("input",{id:"question",type:"text",placeholder:"What is...?",className:"w-full px-4 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white placeholder-gray-400",value:L.question,onChange:e=>P({...L,question:e.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"answer",className:"block text-sm font-medium text-white mb-1",children:"Answer"}),e.jsx("textarea",{id:"answer",placeholder:"Provide a detailed answer...",className:"w-full px-4 py-2 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 bg-gray-800 text-white placeholder-gray-400 min-h-[150px]",value:L.answer,onChange:e=>P({...L,answer:e.target.value}),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>P({category:"",question:"",answer:""}),className:"px-4 py-2 border border-gray-600 text-white rounded-lg hover:bg-gray-600 transition-colors",children:"Clear"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-black rounded-lg hover:from-yellow-600 hover:to-yellow-700 transition-all duration-300",children:"Create FAQ"})]})]}),L.question&&e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Preview"}),e.jsxs("div",{className:"bg-gray-600 p-4 rounded-lg border border-gray-500",children:[e.jsx("h4",{className:"font-medium text-lg text-white mb-2",children:L.question}),e.jsx("div",{className:"prose max-w-none text-gray-300",children:L.answer.split("\n").map(((s,t)=>e.jsx("p",{children:s},t)))}),L.category&&e.jsx("div",{className:"mt-3",children:e.jsx("span",{className:"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full",children:(null==(u=y.find((e=>e.id===L.category)))?void 0:u.name)||"Unknown Category"})})]})]})]})]})]})]}),e.jsx(m,{})]})}export{u as default};
