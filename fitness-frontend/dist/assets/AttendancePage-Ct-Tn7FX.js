import{j as e}from"./ui-D95r1dMF.js";import{r as t}from"./vendor-iz3JPVmO.js";import{a,m as s,y as r}from"./index-CoDTQVyW.js";import"./utils-CCtIn9I6.js";import"./router-D8KzWLZn.js";const l=()=>{const[l,n]=t.useState([]),[i,d]=t.useState([]),[c,o]=t.useState(!1),[x,m]=t.useState((new Date).toISOString().split("T")[0]),[h,u]=t.useState(""),[b,p]=t.useState(!1),[g,y]=t.useState({todayCount:0,weeklyCount:0,monthlyCount:0,totalMembers:0}),j=(e,t)=>{if(!e)return 0;const a=new Date(e),s=new Date,r=Math.floor((s-a)/864e5);return Math.max(0,r-t)},f=(e,t)=>{if(!e)return 0;const a=new Date(e),s=new Date,r=Math.floor((s-a)/864e5);return 0===r?100:Math.min(100,Math.round(t/r*100))};t.useEffect((()=>{N(),w(),v()}),[x,h]);const N=async()=>{try{const e=await a.get("members/");let t;t=Array.isArray(e.data)?e.data:e.data.results&&Array.isArray(e.data.results)?e.data.results:[],d(t)}catch(e){d([])}},w=async()=>{o(!0);try{const e=new URLSearchParams;x&&e.append("date",x),h&&e.append("member_id",h);const t=await a.get(`attendance_history/?${e}`);n(t.data)}catch(e){}finally{o(!1)}},v=async()=>{try{const e=(new Date).toISOString().split("T")[0],t=await a.get(`attendance_history/?date=${e}`),s=new Date;s.setDate(s.getDate()-7);const r=await a.get(`attendance_history/?start_date=${s.toISOString().split("T")[0]}&end_date=${e}`),l=new Date;l.setMonth(l.getMonth()-1);const n=await a.get(`attendance_history/?start_date=${l.toISOString().split("T")[0]}&end_date=${e}`);y({todayCount:t.data.length,weeklyCount:r.data.length,monthlyCount:n.data.length,totalMembers:i.length})}catch(e){}};return e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx(s.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-200 mb-2",children:"Attendance Management"}),e.jsx("p",{className:"text-gray-300",children:"Monitor and manage member attendance"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>p(!b),className:"bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"bx bx-plus"}),"Manual Entry"]}),e.jsxs("button",{onClick:()=>{if(0===l.length)return void r.error("No data to export");const e=[["Date","Member ID","Member Name","Check-in Time","Verification Method"],...l.map((e=>{var t,a;return[e.date,e.member_id,`${(null==(t=e.member)?void 0:t.first_name)||""} ${(null==(a=e.member)?void 0:a.last_name)||""}`,e.check_in_time,e.verification_method]}))].map((e=>e.join(","))).join("\n"),t=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`attendance_${x||"all"}.csv`,s.click(),window.URL.revokeObjectURL(a),r.success("Attendance data exported successfully!")},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx("i",{className:"bx bx-download"}),"Export"]})]})]})}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500/20 to-blue-600/20 backdrop-blur-lg border border-blue-500/30 text-white rounded-xl p-6 shadow-2xl hover:shadow-blue-500/20 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm",children:"Today"}),e.jsx("p",{className:"text-3xl font-bold",children:g.todayCount}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Check-ins"})]}),e.jsx("i",{className:"bx bx-calendar-check text-3xl text-blue-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-500/20 to-green-600/20 backdrop-blur-lg border border-green-500/30 text-white rounded-xl p-6 shadow-2xl hover:shadow-green-500/20 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm",children:"This Week"}),e.jsx("p",{className:"text-3xl font-bold",children:g.weeklyCount}),e.jsx("p",{className:"text-green-100 text-sm",children:"Check-ins"})]}),e.jsx("i",{className:"bx bx-trending-up text-3xl text-green-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-500/20 to-purple-600/20 backdrop-blur-lg border border-purple-500/30 text-white rounded-xl p-6 shadow-2xl hover:shadow-purple-500/20 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-100 text-sm",children:"This Month"}),e.jsx("p",{className:"text-3xl font-bold",children:g.monthlyCount}),e.jsx("p",{className:"text-purple-100 text-sm",children:"Check-ins"})]}),e.jsx("i",{className:"bx bx-bar-chart text-3xl text-purple-200"})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-500/20 to-orange-600/20 backdrop-blur-lg border border-orange-500/30 text-white rounded-xl p-6 shadow-2xl hover:shadow-orange-500/20 transition-all duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm",children:"Total Members"}),e.jsx("p",{className:"text-3xl font-bold",children:g.totalMembers}),e.jsx("p",{className:"text-orange-100 text-sm",children:"Registered"})]}),e.jsx("i",{className:"bx bx-users text-3xl text-orange-200"})]})})]}),b&&e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(s.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-gray-800/60 backdrop-blur-lg border border-gray-600/40 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Manual Attendance Entry"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx("i",{className:"bx bx-x text-2xl"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-1",children:"Select Member"}),e.jsxs("select",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Choose a member..."}),i.map((t=>e.jsxs("option",{value:t.athlete_id,children:[t.first_name," ",t.last_name," (",t.athlete_id,")"]},t.athlete_id)))]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{const e=document.querySelector("select");e.value?((async e=>{var t,s,l;try{const s=(null==(t=(await a.post("webauthn/checkin/",{athlete_id:e,manual_entry:!0})).data)?void 0:t.message)||"";s.includes("Already checked in")?r.info("Member has already checked in today."):s.includes("Check-in successful")?r.success("Manual attendance recorded successfully!"):r.info(s),w(),v()}catch(n){((null==(l=null==(s=n.response)?void 0:s.data)?void 0:l.error)||n.message).includes("Fingerprint not registered")?r.error("Sorry, member not registered yet."):r.error("Failed to record attendance")}})(e.value),p(!1)):r.error("Please select a member")},className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"Record Attendance"}),e.jsx("button",{onClick:()=>p(!1),className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors",children:"Cancel"})]})]})]})}),e.jsx(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gray-800/40 backdrop-blur-lg border border-gray-600/30 rounded-xl shadow-2xl p-6 mb-8 hover:shadow-gray-500/10 transition-all duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Filter by Date"}),e.jsx("input",{type:"date",value:x,onChange:e=>m(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Filter by Member"}),e.jsxs("select",{value:h,onChange:e=>u(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Members"}),i.map((t=>e.jsxs("option",{value:t.athlete_id,children:[t.first_name," ",t.last_name]},t.athlete_id)))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{m(""),u("")},className:"w-full bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-colors",children:"Clear Filters"})})]})}),e.jsxs(s.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gray-800/40 backdrop-blur-lg border border-gray-600/30 rounded-xl shadow-2xl overflow-hidden hover:shadow-gray-500/10 transition-all duration-300",children:[e.jsx("div",{className:"p-6 border-b border-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Attendance Records"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[l.length," records found"]})]})}),c?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-300",children:"Loading attendance data..."}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Please wait while we fetch the records"})]}):0===l.length?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("i",{className:"bx bx-calendar-x text-4xl text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-300",children:"No attendance records found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Member"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date & Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Method"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Absent Days / Rate"})]})}),e.jsx("tbody",{className:"bg-gray-700 divide-y divide-gray-600",children:l.map(((t,a)=>{return e.jsxs("tr",{className:"hover:bg-gray-600",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("i",{className:"bx bx-user text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:t.member_name}),e.jsxs("div",{className:"text-sm text-gray-300",children:["ID: ",t.member_id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-white",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:(r=t.date,new Date(r).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}))}),e.jsx("span",{className:"text-gray-300",children:(s=t.check_in_time,new Date(s).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}))})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("i",{className:"bx bx-fingerprint mr-1"}),t.verification_method]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-red-400 font-medium",children:[j(t.member_start_date,t.member_total_attendance)," absent"]}),e.jsxs("span",{className:"text-green-400 text-xs",children:[f(t.member_start_date,t.member_total_attendance),"% rate"]})]})})]},t.id);var s,r}))})]})})]})]})};export{l as default};
